<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>WebGPU with Rust/WASM</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #gpu-canvas { position: absolute; top: 0; left: 0; }
    </style>
</head>
<body>
    <canvas id="gpu-canvas" width="640" height="480"></canvas>
    <script type="module">
        // Patch outdated WebGPU limit name for newer Chrome versions.
        const origRequestDevice = GPUAdapter.prototype.requestDevice;
        GPUAdapter.prototype.requestDevice = function(desc) {
            if (desc?.requiredLimits?.maxInterStageShaderComponents !== undefined &&
                desc.requiredLimits.maxInterStageShaderVariables === undefined) {
                desc.requiredLimits.maxInterStageShaderVariables =
                    desc.requiredLimits.maxInterStageShaderComponents;
                delete desc.requiredLimits.maxInterStageShaderComponents;
            }
            return origRequestDevice.call(this, desc);
        };

        const canvas = document.getElementById("gpu-canvas");
        canvas.width  = canvas.clientWidth  || 800;
        canvas.height = canvas.clientHeight || 600;

        import init from './pkg/webgpu_wasm.js';
        init();
    </script>
</body>
</html>
