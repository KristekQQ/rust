#!/bin/bash
set -euo pipefail


# Skip extraction if vendor directory already exists
if [ -d "vendor" ]; then
  echo "vendor directory already exists"
  exit 0
fi

# Warn if the WebAssembly target is not installed. Building will fail
# offline without it.
if ! rustup target list --installed | grep -q "wasm32-unknown-unknown"; then
  echo "warning: target 'wasm32-unknown-unknown' not installed." >&2
  echo "         run 'rustup target add wasm32-unknown-unknown' while online" >&2
fi


# Extract vendored crates from vendor.tar.gz
tar -xzvf vendor.tar.gz

# Optionally refresh Cargo metadata if dependencies change
# (requires network access)
# cargo vendor --locked vendor >/dev/null

echo "Vendor directory prepared"
