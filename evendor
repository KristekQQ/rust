#!/bin/bash
set -euo pipefail


# Ensure zstd is available for decompression
command -v zstd >/dev/null || {
  echo "zstd is required to unpack vendor.tar.zst" >&2
  echo "Install it with 'brew install zstd' on macOS or" >&2
  echo "'sudo apt-get install zstd' on Debian/Ubuntu." >&2
  exit 1
}

# Extract vendored crates from the archived vendor.tar.zst file
# Requires `zstd` to be installed.

# Skip extraction if vendor directory already exists
if [ -d "vendor" ]; then
  echo "vendor directory already exists"
  exit 0
fi

# Decompress the archive and extract it
zstd -d vendor.tar.zst -c | tar -xv

# Synchronize Cargo's metadata with the vendor directory
cargo vendor --sync ./vendor >/dev/null

echo "Vendor directory prepared"
